@section head{
	<script type="text/javascript" src="~/Static/Resources/_references.js"></script>
	<link rel="stylesheet" href="~/Static/Resources/site/DesignTShirt_PreviewBuy.css" />


}

<h1>@ViewBag.Title</h1>
<div class="hl"></div>
<div class="DesignInfo">
	<div class="imageShow">
		<div id="ShowEffect" class="group template">
			<script type="text/x-mustache">
			{{#items}}
			<div id="_{{GUID}}_backgroundImage" style="position: relative; background-image: url('/Static/SystemFiles/{{CurrentMaterialTypeID}}/{{CurrentMaterialID}}/{{CurrentColorCode}}/{{FileName}}'); width: {{Width}}px; height: {{Height}}px;">
				<div id="_{{GUID}}_uploadImage" class="uploadImage" style="background-image: url('/Static/UserFiles/{{UserEmail}}/{{DesignworkID}}/{{FileName}}'); width: {{getUploadWidth}}px; height: {{getUploadHeight}}px; left: {{Left}}px; top: {{Top}}px;"></div>
			</div>
			{{/items}}
			</script>
		</div>
	</div>
	<div id="ShowInfo" class="infoShow template">
		<script type="text/x-mustache">
		<div class="buy">
			<a id="buy" class="button submitButton" href="javascript:void(0);" onclick="return false;">￥{{designwork.SellingPrice}} 购买</a>
		</div>
		<h2>关于</h2>
		<div id="Description">{{Description}}</div>
		</script>
	</div>
	<div class="ui-helper-clearfix"></div>
</div>
<div id="ShowMaterialInfo" class="MaterialInfo template">
	<script type="text/x-mustache">
	<div id="MaterialDescription">{{MaterialDescription}}</div>
	</script>
</div>
<div id="BuyList" class="template">
	<hr />
	<script type="text/x-mustache">
	<table>
		<tr>
			<td class="head">型号</td>
			<td class="head">数量</td>
		</tr>
		{{#size}}
		<tr>
			<td class="size">{{SizeName}}：</td>
			<td class="quantity"><input id="_{{GUID}}" value="0" class="Quantity" onkeypress="onlyNumber(this,event)" onblur="onlyNumber(this,event)"/></td>
		</tr>
		{{/size}}
	</table>
	<hr />
	合计：<span id="allQuantity"></span>件、<span id="allPrice"></span>元
	</script>
</div>

@section scripts{
	<script type="text/javascript">
		var Data = @Html.Raw(ViewBag.Data);
		var DataMaterialpictures = { items: @Html.Raw(ViewBag.DataMaterialpictures) };
		var DataDesignwork = { designwork: @Html.Raw(ViewBag.DataDesignwork) };
		var DataSize = { size: @Html.Raw(ViewBag.DataSize) };

		$.extend(Data, DataMaterialpictures);
		$.extend(Data, DataDesignwork);
		$.extend(Data, DataSize);

		$(function ()
		{
			$.initTemplate();
			$("#ShowEffect").data("template_extend", {
				getUploadWidth: function ()
				{
					return this.UploadWidth * this.ShowScale;
				},
				getUploadHeight: function ()
				{
					return this.UploadHeight * this.ShowScale;
				}
			});

			$("#ShowEffect").render(Data);
			$("#ShowInfo").render(Data);
			$("#ShowMaterialInfo").render(Data);
			$("#BuyList").render(Data);

			$("#BuyList").dialog({
				autoOpen: false,
				modal: true,
				title: "选择尺寸和数量",
				buttons: [
				{
					text: "提交订单并付款",
					click: function ()
					{
						var order = "";
						$(":text", "#BuyList").each(function ()
						{
							order += this.id + ":" + this.value + "\n";
						});
						alert(order);
					}
				},
				{
					text: "取消",
					click: function ()
					{
						$(this).dialog("close");
					}
				}]
			});

			$("#buy").click(function ()
			{
				if($("#btnLogin").length != 0)
					$("#loginDialog").dialog("open");
				else
					$("#BuyList").dialog("open");
			});

			$(":text", "#BuyList").change(function ()
			{
				var allQuantity = 0;
				if($(this).val().length == 0)
					$(this).val("0");
				$(":text", "#BuyList").each(function ()
				{
					allQuantity += parseInt(this.value);
				});
				$("#allQuantity").text(allQuantity);
				$("#allPrice").text(RetainDigits(allQuantity * DataDesignwork.designwork.SellingPrice, 2));
			});
		});
	</script>
}