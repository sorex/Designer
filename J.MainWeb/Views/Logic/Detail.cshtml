@{
	ViewBag.Title = "Detail";
}

@section head{
	<script type="text/javascript" src="~/Static/Resources/_references.js"></script>
	<link rel="stylesheet" href="~/Static/Resources/site/Logic_Detail.css" />
}
<div id="StateList" class="ui-helper-clearfix template">
	<script type="text/x-mustache">
	<div class="StateItem{{stateClass}}"><span class="StateString">创建订单</span><span>{{CreateTime}}</span></div>
	<div class="StateItem{{stateClass}}"><span class="StateString">确认订单</span><span>{{ConfirmOrderTime}}</span></div>
	<div class="StateItem{{stateClass}}"><span class="StateString">付款</span><span>{{BuyerPayTime}}</span></div>
	<div class="StateItem{{stateClass}}"><span class="StateString">生产</span><span>{{StartProductionTime}}</span></div>
	<div class="StateItem{{stateClass}}"><span class="StateString">发货</span><span>{{SendGoodsTime}}</span></div>
	<div class="StateItem{{stateClass}}"><span class="StateString">确认收货</span><span>{{ConfirmGoodsTime}}</span></div>
	</script>
</div>
<div id="OrderInfo">
	<div class="Express">
		<span style="font-weight:bold;">订单详情</span>
		<hr />
		<span>收货地址：徐磊，18062011520，， 湖北省 武汉市 武昌区 中南国际城C2座2702室[工作日送]，430071</span>
		<span>订单编号：</span>
		<span>物流：运单号：</span>
		<a href="http://www.kuaidi100.com/chaxun?com={{}}&nu={{}}">查询快递</a>
		https://code.google.com/p/kuaidi-api/wiki/Open_API_Chaxun_URL
	</div>
	<table id="dataTable" class="template">
			<script type="text/x-mustache">
			<tr>
				<th style="width: 60px;"></th>
				<th style="width: 370px;">物品</th>
				<th style="width: 80px;">单价(元)</th>
				<th style="width: 80px;">数量</th>
				<th style="width: 80px;">运费</th>
				<th style="width: 100px;">总价(元)</th>
				<th style="width: 100px;">订单状态</th>
				<th style="width: 100px;">其他操作</th>
			</tr>
			<tr class="sep-row">
				<td colspan="8"></td>
			</tr>
			<tr class="item1">
				<td colspan="8">
					<input type="checkbox" />订单编号：{{GUID}}<span style="margin-left: 20px; display: inline-block;">成交时间：{{CreateTime}}</span>
				</td>
			</tr>
			<tr class="item2">
				<td>
                    <img class="itemImage" alt="查看详情" src="/Static/UserFiles/{{DesignerID}}/{{DesignWorkID}}/50_{{MaterialPictureFileName}}" data-tooptip="data-tooptip" data-tooptipsrc="/Static/UserFiles/{{DesignerID}}/{{DesignWorkID}}/180_{{MaterialPictureFileName}}" />
				</td>
				<td style="text-align: left;">
					<a href="">{{Title}}</a>
					<span class="description">{{OrderDetails}} </span>
				</td>
				<td>{{Price}}</td>
				<td class="rightLine">{{Quantity}}</td>
				<td class="rightLine">{{Freight}}</td>
				<td class="rightLine stress">{{Total}}</td>
				<td class="rightLine">
					{{{stateString}}}
				</td>
				<td>
					<a data-action="" data-guid="{{GUID}}" href="javascript:void(0);" onclick="return false;">退款/退货</a>
				</td>
			</tr>
			</script>
		</table>
</div>

@section scripts{
	<script type="text/javascript">
		var CanPost = true;
		var StateIndex = 0;

		var Data = {};
		var DataOrderInfo = @Html.Raw(ViewBag.DataOrderInfo) ;
		
		$.extend(Data, DataOrderInfo);

		$(function ()
		{
			$.initTemplate();
			$("#StateList").data("template_extend", {
				stateClass: function ()
				{
					var result = "";
					if (this.State > StateIndex)
						result = " StateComplete";
					else if (this.State == StateIndex)
						result = " StateActive";
					StateIndex++;
					return result;
				},
				active: function()
				{
					if(this.IsDefault)
						return " active";
					else
						return "";
				}
			});

			StateIndex = 0;
			$("#StateList").render(Data.OrderInfo);

			$("#dataTable").data("template_extend", {
			    stateString: function ()
			    {
			        switch (this.State)
			        {
			            case 0:
			                return '<a href="/Logic/ConfirmOrder?guid=' + this.GUID + '" target="_blank">确认地址</a>';
			            case 1:
			                return '<a href="/Alipay/Alipay_Pay?OrderID=' + this.GUID + '" target="_blank">付款</a>';
			            case 2:
			                return '<span>等待预售结束</span>';
			            case 3:
			                return '<span>生产中</span>';
			            case 4:
			                return '<span>已发货</span>';
			            case 5:
			                return '<span>确认收货</span>';
			            case 6:
			                return '<span>等待退款审核</span>';
			            case 7:
			                return '<span>退款中</span>';
			            case 8:
			                return '<span>退款被拒绝</span>';
			            case 9:
			                return '<span>等待退货审核</span>';
			            case 10:
			                return '<span>同意退货，请邮寄货物</span>';
			            case 11:
			                return '<span>退货被拒绝</span>';
			            case 12:
			                return '<span>退货成功，退款中</span>';
			            case 13:
			                return '<span>退款成功</span>';
			            case 14:
			                return '<span>退款关闭</span>';
			            case -1:
			                return '<span>交易关闭</span>';
			            default:
			                return '';
			        }
			    },
			    refundString:function()
			    {
			        switch (this.State)
			        {
			            case 2:
			                return '<a data-action="refund" data-guid="' + this.GUID + '" href="javascript:void(0);" onclick="return false;">申请退款</a>';
			            case 4:
			                return '<a data-action="refundgoods" data-guid="' + this.GUID + '" href="javascript:void(0);" onclick="return false;">申请退货</a>';
			            case 8:
			            case 11:
			                return '<span>请联系管理员</span>';
			            default:
			                return '';
			        }
			    }
			});

			$("#dataTable").render(Data.OrderInfo);
		});
	</script>
}